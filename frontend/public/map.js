// common code for the map